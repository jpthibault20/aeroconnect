datasource db {
  provider  = "postgresql" // ou votre provider
  url       = env("DATABASE_URL") // URL Accelerate pour l'application
  directUrl = env("DIRECT_URL") // URL directe pour les migrations
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                      String   @id @unique @default(uuid())
  email                   String   @unique
  clubID                  String?
  firstName               String
  lastName                String
  phone                   String?
  restricted              Boolean  @default(false)
  role                    userRole @default(USER)
  country                 String?
  zipCode                 String?
  adress                  String?
  city                    String?
  clubIDRequest           String?
  classes                 Int[]    @default([])
  canSubscribeWithoutPlan Boolean  @default(false)
}

model flight_sessions {
  id                      String         @id @unique @default(uuid())
  clubID                  String
  sessionDateStart        DateTime       @db.Timestamptz(6)
  sessionDateDuration_min Int
  pilotID                 String
  pilotFirstName          String
  pilotLastName           String
  pilotComment            String?
  studentID               String?
  studentFirstName        String?
  studentLastName         String?
  studentEmail            String?
  studentPhone            String?
  student_type            flightType?
  studentComment          String?
  finalReccurence         DateTime?      @db.Timestamptz(6)
  planeID                 String[]
  studentPlaneID          String?
  classes                 Int[]          @default([])
  // V2.0 : Nouveaux champs pour les carnets de vol
  flightType              NatureOfTheft?
  startLocation           String?
  endLocation             String?
  hobbsStart              Float?
  hobbsEnd                Float?
  landings                Int?           @default(1)
}

model planes {
  id              String            @id @unique @default(uuid())
  clubID          String
  name            String
  immatriculation String
  operational     Boolean           @default(true)
  classes         Int               @default(3)
  // V2.0 : Nouveaux champs pour les carnets de vol
  hobbsTotal      Float?            @default(0)
  // VX.X : Maintenance tasks
  tasks           MaintenanceTask[]
}

model MaintenanceTask {
  id                 String   @id @default(uuid())
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  title              String // Ex: "Visite 50h", "Visite Annuelle", "Changement Huile"
  intervalHours      Float? // Ex: 50 (toutes les 50h)
  intervalMonths     Int? // Ex: 12 (tous les ans) ou 60 (5 ans)
  lastPerformedDate  DateTime // La date de la dernière visite
  lastPerformedHobbs Float // Le total horaire de l'avion à ce moment-là (Ex: 1450.0)
  planeId            String
  plane              planes   @relation(fields: [planeId], references: [id], onDelete: Cascade)
}

model Club {
  id                          String   @id @unique
  Name                        String
  Address                     String?
  City                        String?
  Country                     String?
  ZipCode                     String?
  OwnerId                     String[]
  DaysOn                      String[]
  HoursOn                     Int[]
  SessionDurationMin          Int      @default(60)
  AvailableMinutes            String[] @default([])
  classes                     Int[]    @default([1, 2, 3, 4, 5, 6])
  userCanSubscribe            Boolean  @default(true)
  preSubscribe                Boolean  @default(false)
  timeDelaySubscribeminutes   Int      @default(0)
  userCanUnsubscribe          Boolean  @default(true)
  preUnsubscribe              Boolean  @default(false)
  timeDelayUnsubscribeminutes Int      @default(0)
  firstNameContact            String?
  lastNameContact             String?
  phoneContact                String?
  mailContact                 String?
}

/**
 * ****************************************************************************
 * Enums
 * ****************************************************************************
 */
enum userRole {
  USER
  STUDENT
  PILOT
  OWNER
  ADMIN
  MANAGER
  INSTRUCTOR
}

enum flightType {
  FIRST_FLIGHT
  INITATION
  TRAINING
}

enum NatureOfTheft {
  TRAINING // Instruction
  PRIVATE // Personnel
  SIGHTSEEING // VLO (Vol Local Onéreux / Baptême)
  DISCOVERY // VLD (Vol de Découverte)
  EXAM //(Test en vol)
  // COST_SHARING (Co-avionnage wingly etc)
}
